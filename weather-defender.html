<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2e8b57">
    <meta name="description" content="Battle climate change in this intense environmental strategy game with realistic weather systems and global impact tracking">
    <title>üå™Ô∏è WEATHER DEFENDER XTREME | KijaniHub Climate Warriors</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@400;700&family=Orbitron:wght@700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --pollution-red: #e74c3c;
            --clean-blue: #3498db;
            --action-green: #2ecc71;
            --dark-green: #1e6f3d;
            --light-bg: #f9f9f9;
            --storm-purple: #9b59b6;
            --heat-orange: #e67e22;
            --flood-blue: #2980b9;
            --drought-yellow: #f1c40f;
            --carbon-black: #2c3e50;
            --glow-green: rgba(46, 204, 113, 0.7);
            --glow-red: rgba(231, 76, 60, 0.7);
            --text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            --transition-speed: 0.4s;
            --game-width: 900px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at center, #f0f7f0, #d0e8d0);
            color: var(--carbon-black);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,30 Q50,10 70,30 T90,50 Q70,70 50,90 T10,50 Q30,30 50,10 T90,50" fill="none" stroke="%232e8b57" stroke-width="0.5" opacity="0.1"/></svg>');
            background-size: 200px;
        }
        
        /* ===== Game Container ===== */
        .game-wrapper {
            max-width: var(--game-width);
            margin: 0 auto;
            perspective: 1000px;
        }
        
        .game-container {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15), 
                        0 0 0 1px rgba(255,255,255,0.3) inset,
                        0 0 20px rgba(46, 204, 113, 0.2) inset;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .game-container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, 
                        rgba(46, 204, 113, 0.1) 0%, 
                        rgba(52, 152, 219, 0.1) 50%, 
                        rgba(155, 89, 182, 0.1) 100%);
            z-index: -1;
            border-radius: 30px;
            animation: gradientShift 15s ease infinite;
            background-size: 300% 300%;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ===== Header ===== */
        header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--dark-green);
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
            text-shadow: var(--text-shadow);
            background: linear-gradient(to right, #2e8b57, #3cb371);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--action-green), var(--clean-blue));
            border-radius: 2px;
        }
        
        header p {
            font-size: 1.1rem;
            color: var(--carbon-black);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ===== Stats Panel ===== */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all var(--transition-speed);
            border-left: 4px solid var(--action-green);
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), transparent);
            z-index: -1;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            color: var(--dark-green);
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--carbon-black);
            text-align: center;
            opacity: 0.8;
        }
        
        /* ===== Weather Events Panel ===== */
        .weather-events {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .weather-event {
            width: 22%;
            text-align: center;
            padding: 0.5rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
            opacity: 0.7;
            transition: all var(--transition-speed);
        }
        
        .weather-event.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 0 15px currentColor;
        }
        
        .hurricane { color: var(--storm-purple); }
        .heatwave { color: var(--heat-orange); }
        .flood { color: var(--flood-blue); }
        .drought { color: var(--drought-yellow); }
        
        /* ===== Air Quality Meter ===== */
        .air-quality-container {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .air-quality-title {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .air-quality {
            width: 100%;
            height: 25px;
            background: linear-gradient(90deg, 
                var(--action-green) 0%, 
                var(--action-green) 20%,
                var(--drought-yellow) 40%,
                var(--heat-orange) 60%,
                var(--pollution-red) 80%,
                var(--storm-purple) 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1) inset;
        }
        
        .air-quality::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, 
                rgba(255,255,255,0.8) 0%, 
                rgba(255,255,255,0) 50%,
                rgba(255,255,255,0.8) 100%);
            opacity: 0.3;
        }
        
        .air-quality-marker {
            position: absolute;
            top: -15px;
            left: 50%;
            width: 6px;
            height: 55px;
            background-color: var(--carbon-black);
            transform: translateX(-50%);
            transition: left 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 2;
            border-radius: 3px;
        }
        
        .air-quality-marker::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 10px solid var(--carbon-black);
        }
        
        .air-quality-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--carbon-black);
            opacity: 0.8;
            margin-top: 0.5rem;
        }
        
        /* ===== Feedback System ===== */
        .feedback-system {
            min-height: 60px;
            margin: 1rem 0;
            position: relative;
        }
        
        .feedback-message {
            text-align: center;
            padding: 1rem;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.5s ease;
            background-color: rgba(255,255,255,0.9);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: absolute;
            width: 100%;
            left: 0;
            top: 0;
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }
        
        .feedback-message.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .feedback-message.good {
            background-color: rgba(46, 204, 113, 0.2);
            border-left: 5px solid var(--action-green);
            color: var(--dark-green);
        }
        
        .feedback-message.bad {
            background-color: rgba(231, 76, 60, 0.2);
            border-left: 5px solid var(--pollution-red);
            color: var(--pollution-red);
        }
        
        .feedback-message.warning {
            background-color: rgba(241, 196, 15, 0.2);
            border-left: 5px solid var(--drought-yellow);
            color: var(--heat-orange);
        }
        
        /* ===== Weather Map ===== */
        .weather-map-container {
            position: relative;
            height: 400px;
            border-radius: 15px;
            margin: 2rem 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            background-image: url('https://cdn-icons-png.flaticon.com/512/854/854878.png');
            background-size: cover;
            background-blend-mode: overlay;
            transform-style: preserve-3d;
        }
        
        .weather-map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.1));
            pointer-events: none;
        }
        
        .weather-event-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            z-index: 1;
        }
        
        .hurricane-effect {
            background: radial-gradient(circle at center, rgba(155, 89, 182, 0.1) 0%, transparent 70%);
            animation: hurricaneSpin 20s linear infinite;
        }
        
        .heatwave-effect {
            background: radial-gradient(circle at center, rgba(230, 126, 34, 0.1) 0%, transparent 70%);
            animation: heatPulse 5s ease infinite;
        }
        
        .flood-effect {
            background: linear-gradient(to bottom, rgba(41, 128, 185, 0.1) 0%, transparent 50%);
            animation: waterRipple 10s linear infinite;
        }
        
        .drought-effect {
            background: radial-gradient(circle at center, rgba(241, 196, 15, 0.1) 0%, transparent 70%);
            animation: droughtPulse 8s ease infinite;
        }
        
        @keyframes hurricaneSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes heatPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        @keyframes waterRipple {
            0% { background-size: 100% 100%; }
            50% { background-size: 150% 150%; }
            100% { background-size: 100% 100%; }
        }
        
        @keyframes droughtPulse {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.05); }
        }
        
        /* ===== Pollution Elements ===== */
        .pollution {
            position: absolute;
            width: 70px;
            height: 70px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            transition: all 0.3s;
            filter: drop-shadow(0 0 8px var(--glow-red));
            animation: float 3s infinite ease-in-out;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .pollution.selected {
            filter: drop-shadow(0 0 20px gold);
            animation: pulse 0.5s infinite alternate, float 3s infinite ease-in-out;
            transform: scale(1.1);
            z-index: 3;
        }
        
        .pollution.removing {
            animation: explode 0.5s forwards;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1.1); }
            100% { transform: scale(1.2); }
        }
        
        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(0.5); opacity: 0; }
        }
        
        /* ===== Solutions Panel ===== */
        .solutions-panel {
            position: relative;
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }
        
        .solution-card {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-speed);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .solution-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0) 60%
            );
            transform: rotate(30deg);
        }
        
        .solution-card:hover {
            transform: translateY(-10px) scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .solution-card:active {
            transform: translateY(0) scale(0.95);
        }
        
        .solution-card.active {
            box-shadow: 0 0 0 4px white, 0 0 0 8px var(--action-green), 0 0 20px var(--glow-green);
            animation: glow 1.5s infinite alternate;
        }
        
        .solution-card.disabled {
            opacity: 0.5;
            filter: grayscale(0.7);
            pointer-events: none;
        }
        
        .solution-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        
        .solution-name {
            font-size: 0.7rem;
            font-weight: bold;
            text-align: center;
            color: var(--carbon-black);
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 0 4px white, 0 0 0 8px var(--action-green), 0 0 20px var(--glow-green); }
            100% { box-shadow: 0 0 0 4px white, 0 0 0 8px var(--action-green), 0 0 30px var(--glow-green); }
        }
        
        /* ===== Controls ===== */
        .controls-panel {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .game-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            background: linear-gradient(to right, var(--action-green), var(--dark-green));
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 150px;
            text-align: center;
        }
        
        .game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: all 0.5s;
        }
        
        .game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(46, 204, 113, 0.4);
        }
        
        .game-btn:hover::before {
            left: 100%;
        }
        
        .game-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(46, 204, 113, 0.3);
        }
        
        .game-btn.secondary {
            background: linear-gradient(to right, var(--clean-blue), #2980b9);
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .game-btn.secondary:hover {
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.4);
        }
        
        .game-btn.warning {
            background: linear-gradient(to right, var(--drought-yellow), var(--heat-orange));
            box-shadow: 0 4px 10px rgba(241, 196, 15, 0.3);
        }
        
        .game-btn.warning:hover {
            box-shadow: 0 8px 15px rgba(241, 196, 15, 0.4);
        }
        
        /* ===== Tutorial ===== */
        .tutorial-panel {
            background: linear-gradient(to bottom, rgba(255,255,255,0.9), rgba(240,247,240,0.9));
            padding: 1.5rem;
            border-radius: 15px;
            margin-top: 2rem;
            border-left: 5px solid var(--action-green);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .tutorial-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, var(--action-green), var(--clean-blue), var(--storm-purple));
        }
        
        .tutorial-title {
            font-family: 'Fredoka One', cursive;
            color: var(--dark-green);
            margin-bottom: 1rem;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tutorial-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            list-style-type: none;
        }
        
        .tutorial-item {
            background: rgba(255,255,255,0.7);
            padding: 1rem;
            border-radius: 10px;
            transition: all var(--transition-speed);
            border-left: 3px solid var(--action-green);
        }
        
        .tutorial-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .tutorial-item strong {
            color: var(--dark-green);
            display: block;
            margin-bottom: 0.3rem;
            font-size: 1.1rem;
        }
        
        /* ===== Global Impact ===== */
        .global-impact {
            margin-top: 2rem;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: none;
        }
        
        .impact-title {
            font-family: 'Fredoka One', cursive;
            color: var(--dark-green);
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .impact-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            text-align: center;
        }
        
        .impact-stat {
            background: rgba(240,247,240,0.7);
            padding: 1rem;
            border-radius: 10px;
            border-bottom: 3px solid var(--action-green);
        }
        
        .impact-value {
            font-size: 2rem;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            color: var(--dark-green);
            margin-bottom: 0.5rem;
        }
        
        .impact-label {
            font-size: 0.9rem;
            color: var(--carbon-black);
        }
        
        /* ===== Weather Event Modal ===== */
        .weather-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            backdrop-filter: blur(5px);
        }
        
        .weather-modal.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .weather-modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .modal-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }
        
        .hurricane-modal .modal-title { color: var(--storm-purple); }
        .heatwave-modal .modal-title { color: var(--heat-orange); }
        .flood-modal .modal-title { color: var(--flood-blue); }
        .drought-modal .modal-title { color: var(--drought-yellow); }
        
        .modal-text {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .modal-btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 50px;
            background: var(--action-green);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-speed);
        }
        
        .modal-btn:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
        }
        
        /* ===== Pause Overlay ===== */
        .pause-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .pause-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .pause-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .pause-icon {
            font-size: 3rem;
            color: var(--action-green);
            margin-bottom: 1rem;
        }
        
        .pause-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            color: var(--dark-green);
            margin-bottom: 1rem;
        }
        
        /* ===== Responsive Design ===== */
        @media (max-width: 768px) {
            .game-container {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .stats-panel {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .weather-map-container {
                height: 300px;
            }
            
            .solutions-panel {
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .solution-card {
                width: 70px;
                height: 70px;
            }
            
            .solution-icon {
                font-size: 2rem;
            }
            
            .controls-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .game-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .tutorial-list {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .solution-card {
                width: 60px;
                height: 60px;
            }
            
            .solution-icon {
                font-size: 1.8rem;
            }
            
            .solution-name {
                font-size: 0.6rem;
            }
        }
        
        /* ===== Animations ===== */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        /* ===== Particle Effects ===== */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .particle {
            position: absolute;
            background-color: currentColor;
            border-radius: 50%;
            pointer-events: none;
        }
        
        /* ===== Progress Bar ===== */
        .progress-container {
            width: 100%;
            height: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--action-green), var(--clean-blue));
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        /* ===== Achievement Badges ===== */
        .achievement-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 300px;
        }
        
        .achievement-badge.show {
            transform: translateX(0);
        }
        
        .badge-icon {
            font-size: 2rem;
            color: gold;
        }
        
        .badge-content h4 {
            margin-bottom: 0.3rem;
            color: var(--dark-green);
        }
        
        .badge-content p {
            font-size: 0.9rem;
            color: var(--carbon-black);
        }
    </style>
</head>
<body>
    <!-- Weather Event Modals -->
    <div class="weather-modal hurricane-modal">
        <div class="modal-content">
            <div class="modal-icon">üå™Ô∏è</div>
            <h3 class="modal-title">HURRICANE WARNING!</h3>
            <p class="modal-text">Rising sea temperatures have intensified this hurricane! Take action to reduce global warming and prevent future storms.</p>
            <button class="modal-btn">Continue</button>
        </div>
    </div>
    
    <div class="weather-modal heatwave-modal">
        <div class="modal-content">
            <div class="modal-icon">üî•</div>
            <h3 class="modal-title">HEATWAVE ALERT!</h3>
            <p class="modal-text">Record-breaking temperatures! Extreme heat events are becoming more frequent due to climate change.</p>
            <button class="modal-btn">Continue</button>
        </div>
    </div>
    
    <div class="weather-modal flood-modal">
        <div class="modal-content">
            <div class="modal-icon">üåä</div>
            <h3 class="modal-title">FLOOD WARNING!</h3>
            <p class="modal-text">Heavy rainfall has caused dangerous flooding. Climate change increases extreme precipitation events.</p>
            <button class="modal-btn">Continue</button>
        </div>
    </div>
    
    <div class="weather-modal drought-modal">
        <div class="modal-content">
            <div class="modal-icon">üèúÔ∏è</div>
            <h3 class="modal-title">DROUGHT ALERT!</h3>
            <p class="modal-text">Prolonged drought conditions threaten water supplies. Climate change exacerbates drought severity.</p>
            <button class="modal-btn">Continue</button>
        </div>
    </div>
    
    <!-- Pause Overlay -->
    <div class="pause-overlay">
        <div class="pause-content">
            <div class="pause-icon">‚è∏Ô∏è</div>
            <h3 class="pause-title">GAME PAUSED</h3>
            <p>Take your time to strategize your next climate action!</p>
            <button class="game-btn" id="resume-btn">Resume Game</button>
        </div>
    </div>
    
    <!-- Achievement Badge -->
    <div class="achievement-badge" id="achievement-badge">
        <div class="badge-icon">üèÜ</div>
        <div class="badge-content">
            <h4>Climate Champion!</h4>
            <p>You've reduced 50 tons of CO‚ÇÇ emissions!</p>
        </div>
    </div>
    
    <!-- Main Game Container -->
    <div class="game-wrapper">
        <div class="game-container" id="game-container">
            <header>
                <h1>üå™Ô∏è WEATHER DEFENDER XTREME</h1>
                <p>Battle climate change in this intense environmental strategy game with realistic weather systems and global impact tracking</p>
            </header>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-value" id="pollution-stopped">0</div>
                    <div class="stat-label">Pollution Sources Stopped</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="co2-reduced">0 <small>tons</small></div>
                    <div class="stat-label">CO‚ÇÇ Emissions Reduced</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="time-left">60 <small>sec</small></div>
                    <div class="stat-label">Time Remaining</div>
                </div>
            </div>
            
            <div class="weather-events">
                <div class="weather-event hurricane" id="hurricane-event">
                    üå™Ô∏è Hurricane Risk: 0%
                </div>
                <div class="weather-event heatwave" id="heatwave-event">
                    üî• Heatwave Risk: 0%
                </div>
                <div class="weather-event flood" id="flood-event">
                    üåä Flood Risk: 0%
                </div>
                <div class="weather-event drought" id="drought-event">
                    üèúÔ∏è Drought Risk: 0%
                </div>
            </div>
            
            <div class="air-quality-container">
                <div class="air-quality-title">
                    <span>Global Air Quality Index</span>
                    <span id="aqi-value">50 (Moderate)</span>
                </div>
                <div class="air-quality">
                    <div class="air-quality-marker" id="air-quality-marker"></div>
                </div>
                <div class="air-quality-labels">
                    <span>Good</span>
                    <span>Moderate</span>
                    <span>Unhealthy</span>
                    <span>Hazardous</span>
                </div>
            </div>
            
            <div class="feedback-system" id="feedback-system">
                <div class="feedback-message" id="feedback-message">
                    Click on pollution sources to select them, then choose a solution below to eliminate them!
                </div>
            </div>
            
            <div class="weather-map-container" id="weather-map-container">
                <div class="weather-map" id="weather-map">
                    <!-- Pollution sources will be generated here -->
                </div>
                <div class="weather-map-overlay"></div>
                <div class="weather-event-effect hurricane-effect" id="hurricane-effect"></div>
                <div class="weather-event-effect heatwave-effect" id="heatwave-effect"></div>
                <div class="weather-event-effect flood-effect" id="flood-effect"></div>
                <div class="weather-event-effect drought-effect" id="drought-effect"></div>
                <div class="particles" id="particles"></div>
            </div>
            
            <div class="solutions-panel">
                <div class="solution-card" id="renewable-btn" title="Renewable Energy">
                    <div class="solution-icon">‚òÄÔ∏è</div>
                    <div class="solution-name">Clean Energy</div>
                </div>
                <div class="solution-card" id="tree-btn" title="Plant Trees">
                    <div class="solution-icon">üå≥</div>
                    <div class="solution-name">Reforestation</div>
                </div>
                <div class="solution-card" id="transport-btn" title="Clean Transport">
                    <div class="solution-icon">üö≤</div>
                    <div class="solution-name">Eco Transport</div>
                </div>
                <div class="solution-card" id="recycle-btn" title="Recycling">
                    <div class="solution-icon">‚ôªÔ∏è</div>
                    <div class="solution-name">Waste Mgmt</div>
                </div>
            </div>
            
            <div class="controls-panel">
                <button class="game-btn" id="start-btn">Start Mission</button>
                <button class="game-btn secondary" id="reset-btn">Reset Game</button>
                <button class="game-btn warning" id="global-btn">Global Impact</button>
            </div>
            
            <div class="tutorial-panel">
                <h3 class="tutorial-title">üìö Climate Solutions Guide</h3>
                <ul class="tutorial-list">
                    <li class="tutorial-item">
                        <strong>Clean Energy (‚òÄÔ∏è)</strong>
                        Replace fossil fuels with solar, wind, and hydro power to reduce emissions at factories and power plants
                    </li>
                    <li class="tutorial-item">
                        <strong>Reforestation (üå≥)</strong>
                        Plant trees to absorb CO‚ÇÇ from all pollution sources and improve air quality
                    </li>
                    <li class="tutorial-item">
                        <strong>Eco Transport (üö≤)</strong>
                        Promote electric vehicles, biking, and public transit to reduce vehicle emissions
                    </li>
                    <li class="tutorial-item">
                        <strong>Waste Management (‚ôªÔ∏è)</strong>
                        Recycle and reduce waste to minimize landfill emissions and resource consumption
                    </li>
                </ul>
            </div>
            
            <div class="global-impact" id="global-impact">
                <h3 class="impact-title">üåç Your Global Impact</h3>
                <div class="impact-stats">
                    <div class="impact-stat">
                        <div class="impact-value" id="games-played">0</div>
                        <div class="impact-label">Missions Completed</div>
                    </div>
                    <div class="impact-stat">
                        <div class="impact-value" id="total-co2">0</div>
                        <div class="impact-label">Total CO‚ÇÇ Reduced (tons)</div>
                    </div>
                    <div class="impact-stat">
                        <div class="impact-value" id="trees-planted">0</div>
                        <div class="impact-label">Equivalent Trees Planted</div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="impact-progress" style="width: 0%"></div>
                </div>
                <p style="text-align: center; font-size: 0.9rem; margin-top: 0.5rem;">
                    <span id="progress-text">0%</span> towards becoming a Climate Hero!
                </p>
            </div>
        </div>
    </div>

    <script>
        // ===== Game Configuration =====
        const config = {
            gameDuration: 60, // seconds
            pollutionSpawnRate: 2000, // milliseconds
            maxPollution: 10,
            airQualityImpact: 5, // points per pollution
            solutionImpact: 10, // points per solution
            weatherEventThreshold: 70, // AQI threshold for weather events
            weatherEventChance: 0.3, // 30% chance when threshold reached
            achievementThresholds: [10, 25, 50, 100], // CO2 tons for achievements
            difficultyIncrease: 1.1 // multiplier per level
        };
        
        // ===== Game Data =====
        const pollutionSources = [
            { 
                type: "factory", 
                co2: 5, 
                icon: "üè≠",
                description: "Industrial factories emitting greenhouse gases",
                spawnChance: 0.3
            },
            { 
                type: "car", 
                co2: 2, 
                icon: "üöó",
                description: "Gasoline vehicles contributing to air pollution",
                spawnChance: 0.4
            },
            { 
                type: "coal", 
                co2: 8, 
                icon: "‚ö°",
                description: "Coal power plants releasing massive CO‚ÇÇ",
                spawnChance: 0.2
            },
            { 
                type: "waste", 
                co2: 3, 
                icon: "üóëÔ∏è",
                description: "Landfill waste producing methane emissions",
                spawnChance: 0.3
            },
            { 
                type: "plane", 
                co2: 6, 
                icon: "‚úàÔ∏è",
                description: "Airplanes with high carbon footprint",
                spawnChance: 0.1
            },
            { 
                type: "deforestation", 
                co2: 7, 
                icon: "ü™ì",
                description: "Deforestation reducing carbon absorption",
                spawnChance: 0.2
            }
        ];
        
        const solutions = {
            "renewable": { 
                name: "Renewable Energy",
                target: ["factory", "coal"], 
                co2: 7, 
                icon: "‚òÄÔ∏è",
                description: "Replace fossil fuels with solar, wind, and hydro power",
                color: "#f1c40f"
            },
            "tree": { 
                name: "Reforestation",
                target: ["all"], 
                co2: 4, 
                icon: "üå≥",
                description: "Plant trees to absorb CO‚ÇÇ from all sources",
                color: "#2ecc71"
            },
            "transport": { 
                name: "Clean Transport",
                target: ["car", "plane"], 
                co2: 5, 
                icon: "üö≤",
                description: "Promote electric vehicles and public transit",
                color: "#3498db"
            },
            "recycle": { 
                name: "Waste Management",
                target: ["waste", "deforestation"], 
                co2: 4, 
                icon: "‚ôªÔ∏è",
                description: "Recycle and reduce waste to minimize emissions",
                color: "#9b59b6"
            }
        };
        
        const weatherEvents = [
            {
                type: "hurricane",
                name: "Hurricane",
                icon: "üå™Ô∏è",
                description: "Intensified by rising sea temperatures",
                aqiThreshold: 70,
                effect: "hurricane-effect",
                modal: "hurricane-modal",
                risk: 0
            },
            {
                type: "heatwave",
                name: "Heatwave",
                icon: "üî•",
                description: "Caused by increasing global temperatures",
                aqiThreshold: 65,
                effect: "heatwave-effect",
                modal: "heatwave-modal",
                risk: 0
            },
            {
                type: "flood",
                name: "Flood",
                icon: "üåä",
                description: "Extreme precipitation from climate change",
                aqiThreshold: 75,
                effect: "flood-effect",
                modal: "flood-modal",
                risk: 0
            },
            {
                type: "drought",
                name: "Drought",
                icon: "üèúÔ∏è",
                description: "Prolonged dry periods due to climate shifts",
                aqiThreshold: 60,
                effect: "drought-effect",
                modal: "drought-modal",
                risk: 0
            }
        ];
        
        const achievements = [
            {
                title: "Eco Beginner",
                description: "Reduced 10 tons of CO‚ÇÇ emissions",
                icon: "üå±",
                threshold: 10
            },
            {
                title: "Climate Warrior",
                description: "Reduced 25 tons of CO‚ÇÇ emissions",
                icon: "üõ°Ô∏è",
                threshold: 25
            },
            {
                title: "Environmental Hero",
                description: "Reduced 50 tons of CO‚ÇÇ emissions",
                icon: "üèÜ",
                threshold: 50
            },
            {
                title: "Planet Savior",
                description: "Reduced 100 tons of CO‚ÇÇ emissions",
                icon: "üåç",
                threshold: 100
            }
        ];
        
        // ===== Game State =====
        let gameState = {
            pollutionStopped: 0,
            co2Reduced: 0,
            timeLeft: config.gameDuration,
            airQuality: 50,
            gameActive: false,
            gameLevel: 1,
            selectedPollution: null,
            timerInterval: null,
            pollutionInterval: null,
            activePollution: [],
            weatherEvents: JSON.parse(JSON.stringify(weatherEvents)),
            difficulty: 1,
            achievementsUnlocked: []
        };
        
        // ===== DOM Elements =====
        const dom = {
            // Containers
            gameContainer: document.getElementById('game-container'),
            weatherMap: document.getElementById('weather-map'),
            weatherMapContainer: document.getElementById('weather-map-container'),
            feedbackSystem: document.getElementById('feedback-system'),
            globalImpact: document.getElementById('global-impact'),
            particles: document.getElementById('particles'),
            
            // Stats
            pollutionStopped: document.getElementById('pollution-stopped'),
            co2Reduced: document.getElementById('co2-reduced'),
            timeLeft: document.getElementById('time-left'),
            aqiValue: document.getElementById('aqi-value'),
            
            // Air Quality
            airQualityMarker: document.getElementById('air-quality-marker'),
            
            // Weather Events
            hurricaneEvent: document.getElementById('hurricane-event'),
            heatwaveEvent: document.getElementById('heatwave-event'),
            floodEvent: document.getElementById('flood-event'),
            droughtEvent: document.getElementById('drought-event'),
            hurricaneEffect: document.getElementById('hurricane-effect'),
            heatwaveEffect: document.getElementById('heatwave-effect'),
            floodEffect: document.getElementById('flood-effect'),
            droughtEffect: document.getElementById('drought-effect'),
            
            // Feedback
            feedbackMessage: document.getElementById('feedback-message'),
            
            // Solutions
            renewableBtn: document.getElementById('renewable-btn'),
            treeBtn: document.getElementById('tree-btn'),
            transportBtn: document.getElementById('transport-btn'),
            recycleBtn: document.getElementById('recycle-btn'),
            
            // Controls
            startBtn: document.getElementById('start-btn'),
            resetBtn: document.getElementById('reset-btn'),
            globalBtn: document.getElementById('global-btn'),
            resumeBtn: document.getElementById('resume-btn'),
            
            // Modals
            weatherModals: {
                hurricane: document.querySelector('.hurricane-modal'),
                heatwave: document.querySelector('.heatwave-modal'),
                flood: document.querySelector('.flood-modal'),
                drought: document.querySelector('.drought-modal')
            },
            
            // Pause
            pauseOverlay: document.querySelector('.pause-overlay'),
            
            // Global Impact
            gamesPlayed: document.getElementById('games-played'),
            totalCo2: document.getElementById('total-co2'),
            treesPlanted: document.getElementById('trees-planted'),
            impactProgress: document.getElementById('impact-progress'),
            progressText: document.getElementById('progress-text'),
            
            // Achievement
            achievementBadge: document.getElementById('achievement-badge')
        };
        
        // ===== Game Initialization =====
        function initGame() {
            // Reset game state
            gameState = {
                pollutionStopped: 0,
                co2Reduced: 0,
                timeLeft: config.gameDuration,
                airQuality: 50,
                gameActive: false,
                gameLevel: 1,
                selectedPollution: null,
                timerInterval: null,
                pollutionInterval: null,
                activePollution: [],
                weatherEvents: JSON.parse(JSON.stringify(weatherEvents)),
                difficulty: 1,
                achievementsUnlocked: []
            };
            
            // Update UI
            updateStats();
            updateAirQualityDisplay();
            dom.weatherMap.innerHTML = '';
            dom.feedbackMessage.textContent = 'Click on pollution sources to select them, then choose a solution below to eliminate them!';
            dom.feedbackMessage.className = 'feedback-message';
            dom.startBtn.textContent = 'Start Mission';
            
            // Reset weather events
            gameState.weatherEvents.forEach(event => {
                event.risk = 0;
                updateWeatherEventDisplay(event.type);
                document.getElementById(`${event.type}-effect`).style.opacity = '0';
            });
            
            // Clear intervals
            clearInterval(gameState.timerInterval);
            clearInterval(gameState.pollutionInterval);
            
            // Reset solution buttons
            Object.keys(dom).forEach(key => {
                if (key.endsWith('Btn') && key !== 'startBtn' && key !== 'resetBtn' && key !== 'globalBtn' && key !== 'resumeBtn') {
                    dom[key].className = 'solution-card';
                }
            });
            
            // Hide global impact
            dom.globalImpact.style.display = 'none';
        }
        
        // ===== Game Controls =====
        function startGame() {
            if (gameState.gameActive) {
                pauseGame();
                return;
            }
            
            gameState.gameActive = true;
            dom.startBtn.textContent = 'Pause Mission';
            
            // Start timer
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                updateStats();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
            
            // Start generating pollution
            gameState.pollutionInterval = setInterval(() => {
                generatePollution();
            }, config.pollutionSpawnRate / gameState.difficulty);
            
            // Initial pollution
            for (let i = 0; i < 3; i++) {
                setTimeout(() => generatePollution(), i * 500);
            }
        }
        
        function pauseGame() {
            gameState.gameActive = false;
            dom.startBtn.textContent = 'Resume Mission';
            clearInterval(gameState.timerInterval);
            clearInterval(gameState.pollutionInterval);
            dom.pauseOverlay.classList.add('active');
        }
        
        function resumeGame() {
            gameState.gameActive = true;
            dom.startBtn.textContent = 'Pause Mission';
            dom.pauseOverlay.classList.remove('active');
            
            // Restart timer
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                updateStats();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
            
            // Restart pollution generation
            gameState.pollutionInterval = setInterval(() => {
                generatePollution();
            }, config.pollutionSpawnRate / gameState.difficulty);
        }
        
        function endGame() {
            gameState.gameActive = false;
            clearInterval(gameState.timerInterval);
            clearInterval(gameState.pollutionInterval);
            dom.startBtn.textContent = 'Play Again';
            
            // Remove all pollution
            dom.weatherMap.innerHTML = '';
            gameState.activePollution = [];
            
            // Show feedback
            let feedback = `Mission Complete! You stopped ${gameState.pollutionStopped} pollution sources and reduced ${gameState.co2Reduced} tons of CO‚ÇÇ! `;
            let feedbackClass = 'feedback-message';
            
            if (gameState.co2Reduced >= 30) {
                feedback += "You're a Climate Hero! üåç";
                feedbackClass += ' good';
            } else if (gameState.co2Reduced >= 15) {
                feedback += "Good effort! Every action helps fight climate change.";
                feedbackClass += ' good';
            } else {
                feedback += "Keep practicing to make a bigger impact!";
                feedbackClass += ' warning';
            }
            
            dom.feedbackMessage.textContent = feedback;
            dom.feedbackMessage.className = feedbackClass;
            
            // Update global stats
            updateGlobalStats();
            
            // Check for achievements
            checkAchievements();
            
            // Increase difficulty for next level
            gameState.difficulty *= config.difficultyIncrease;
            gameState.gameLevel++;
        }
        
        // ===== Game Mechanics =====
        function generatePollution() {
            if (!gameState.gameActive || gameState.activePollution.length >= config.maxPollution) return;
            
            // Weighted random selection based on spawn chance
            let totalChance = 0;
            pollutionSources.forEach(source => {
                totalChance += source.spawnChance;
            });
            
            let random = Math.random() * totalChance;
            let selectedSource = null;
            let cumulativeChance = 0;
            
            for (const source of pollutionSources) {
                cumulativeChance += source.spawnChance;
                if (random <= cumulativeChance) {
                    selectedSource = source;
                    break;
                }
            }
            
            if (!selectedSource) selectedSource = pollutionSources[0];
            
            const pollution = document.createElement('div');
            pollution.className = 'pollution';
            pollution.textContent = selectedSource.icon;
            pollution.dataset.type = selectedSource.type;
            pollution.dataset.co2 = selectedSource.co2;
            pollution.dataset.id = Date.now() + Math.random().toString(36).substr(2, 5);
            pollution.title = selectedSource.description;
            
            // Random position
            const posX = Math.random() * (dom.weatherMap.offsetWidth - 70);
            const posY = Math.random() * (dom.weatherMap.offsetHeight - 70);
            
            pollution.style.left = `${posX}px`;
            pollution.style.top = `${posY}px`;
            
            // Click handler
            pollution.addEventListener('click', () => selectPollution(pollution));
            
            dom.weatherMap.appendChild(pollution);
            gameState.activePollution.push({
                element: pollution,
                id: pollution.dataset.id,
                type: selectedSource.type,
                co2: selectedSource.co2
            });
            
            // Worsen air quality
            gameState.airQuality += config.airQualityImpact;
            if (gameState.airQuality > 100) gameState.airQuality = 100;
            updateAirQualityDisplay();
            
            // Check for weather events
            checkWeatherEvents();
        }
        
        function selectPollution(pollutionElement) {
            if (!gameState.gameActive) return;
            
            // Deselect current
            if (gameState.selectedPollution) {
                gameState.selectedPollution.element.classList.remove('selected');
            }
            
            // Select new
            const selected = gameState.activePollution.find(p => p.id === pollutionElement.dataset.id);
            if (!selected) return;
            
            gameState.selectedPollution = selected;
            pollutionElement.classList.add('selected');
            
            // Highlight compatible solutions
            Object.keys(solutions).forEach(key => {
                const solution = solutions[key];
                if (solution.target.includes('all') || solution.target.includes(selected.type)) {
                    dom[`${key}Btn`].classList.add('active');
                } else {
                    dom[`${key}Btn`].classList.add('disabled');
                }
            });
            
            // Show feedback
            showFeedback(`Selected: ${pollutionSources.find(s => s.type === selected.type).description}`, 'warning');
        }
        
        function applySolution(solutionType) {
            if (!gameState.gameActive || !gameState.selectedPollution) return;
            
            const solution = solutions[solutionType];
            const pollution = gameState.selectedPollution;
            
            // Check if solution applies to this pollution type
            if (!solution.target.includes('all') && !solution.target.includes(pollution.type)) {
                showFeedback(`This solution doesn't work on ${pollution.type} pollution!`, 'bad');
                return;
            }
            
            // Remove pollution with effect
            pollution.element.classList.remove('selected');
            pollution.element.classList.add('removing');
            
            // Create particles
            createParticles(
                pollution.element.offsetLeft + pollution.element.offsetWidth / 2,
                pollution.element.offsetTop + pollution.element.offsetHeight / 2,
                solution.color
            );
            
            setTimeout(() => {
                pollution.element.remove();
                gameState.activePollution = gameState.activePollution.filter(p => p.id !== pollution.id);
            }, 500);
            
            // Update stats
            gameState.pollutionStopped++;
            gameState.co2Reduced += solution.co2;
            gameState.airQuality -= config.solutionImpact;
            if (gameState.airQuality < 0) gameState.airQuality = 0;
            
            updateStats();
            updateAirQualityDisplay();
            
            // Show feedback
            showFeedback(`Great! ${solution.name} reduced ${solution.co2} tons of CO‚ÇÇ!`, 'good');
            
            // Reset solution buttons
            Object.keys(solutions).forEach(key => {
                dom[`${key}Btn`].className = 'solution-card';
            });
            
            gameState.selectedPollution = null;
        }
        
        function checkWeatherEvents() {
            gameState.weatherEvents.forEach(event => {
                // Increase risk if AQI is above threshold
                if (gameState.airQuality >= event.aqiThreshold) {
                    event.risk += 5 * gameState.difficulty;
                    if (event.risk > 100) event.risk = 100;
                } else {
                    event.risk -= 2;
                    if (event.risk < 0) event.risk = 0;
                }
                
                updateWeatherEventDisplay(event.type);
                
                // Randomly trigger event if risk is high
                if (event.risk >= 80 && Math.random() < config.weatherEventChance) {
                    triggerWeatherEvent(event.type);
                }
            });
        }
        
        function triggerWeatherEvent(type) {
            const event = gameState.weatherEvents.find(e => e.type === type);
            if (!event) return;
            
            // Show modal
            dom.weatherModals[type].classList.add('active');
            
            // Show effect
            document.getElementById(`${type}-effect`).style.opacity = '0.5';
            
            // Reset risk
            event.risk = 0;
            updateWeatherEventDisplay(type);
            
            // Pause game during event
            const wasActive = gameState.gameActive;
            if (wasActive) pauseGame();
            
            // Close modal handler
            const modalBtn = dom.weatherModals[type].querySelector('.modal-btn');
            const handler = () => {
                dom.weatherModals[type].classList.remove('active');
                document.getElementById(`${type}-effect`).style.opacity = '0';
                modalBtn.removeEventListener('click', handler);
                
                if (wasActive) resumeGame();
            };
            
            modalBtn.addEventListener('click', handler);
        }
        
        function createParticles(x, y, color) {
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.backgroundColor = color;
                particle.style.width = `${Math.random() * 8 + 4}px`;
                particle.style.height = particle.style.width;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 5 + 2;
                const lifetime = Math.random() * 1000 + 500;
                
                dom.particles.appendChild(particle);
                
                let startTime = Date.now();
                
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = elapsed / lifetime;
                    
                    if (progress >= 1) {
                        particle.remove();
                        return;
                    }
                    
                    const currentX = x + Math.cos(angle) * velocity * elapsed / 20;
                    const currentY = y + Math.sin(angle) * velocity * elapsed / 20 - (elapsed * elapsed) / 10000;
                    
                    particle.style.left = `${currentX}px`;
                    particle.style.top = `${currentY}px`;
                    particle.style.opacity = 1 - progress;
                    
                    requestAnimationFrame(animate);
                };
                
                animate();
            }
        }
        
        // ===== UI Updates =====
        function updateStats() {
            dom.pollutionStopped.textContent = gameState.pollutionStopped;
            dom.co2Reduced.textContent = gameState.co2Reduced;
            dom.timeLeft.textContent = gameState.timeLeft;
        }
        
        function updateAirQualityDisplay() {
            // Map 0-100 to 5%-95% (to keep marker within bar)
            const markerPos = 5 + (gameState.airQuality * 0.9);
            dom.airQualityMarker.style.left = `${markerPos}%`;
            
            // Update AQI text
            let aqiText = '';
            let aqiClass = '';
            
            if (gameState.airQuality >= 80) {
                aqiText = `${gameState.airQuality} (Hazardous)`;
                aqiClass = 'bad';
            } else if (gameState.airQuality >= 60) {
                aqiText = `${gameState.airQuality} (Unhealthy)`;
                aqiClass = 'bad';
            } else if (gameState.airQuality >= 40) {
                aqiText = `${gameState.airQuality} (Moderate)`;
                aqiClass = 'warning';
            } else {
                aqiText = `${gameState.airQuality} (Good)`;
                aqiClass = 'good';
            }
            
            dom.aqiValue.textContent = aqiText;
        }
        
        function updateWeatherEventDisplay(type) {
            const event = gameState.weatherEvents.find(e => e.type === type);
            if (!event) return;
            
            const element = document.getElementById(`${type}-event`);
            element.textContent = `${event.icon} ${event.name} Risk: ${Math.round(event.risk)}%`;
            element.style.opacity = event.risk > 0 ? '1' : '0.7';
            element.style.transform = event.risk > 50 ? 'scale(1.05)' : 'scale(1)';
            
            if (event.risk > 80) {
                element.classList.add('active');
            } else {
                element.classList.remove('active');
            }
        }
        
        function showFeedback(message, type = '') {
            dom.feedbackMessage.textContent = message;
            dom.feedbackMessage.className = `feedback-message ${type}`;
            
            // Animate
            dom.feedbackMessage.classList.remove('active');
            setTimeout(() => {
                dom.feedbackMessage.classList.add('active');
            }, 10);
            
            // Auto-hide after delay unless it's important
            if (type !== 'bad') {
                setTimeout(() => {
                    if (dom.feedbackMessage.textContent === message) {
                        dom.feedbackMessage.classList.remove('active');
                    }
                }, 3000);
            }
        }
        
        // ===== Global Stats & Achievements =====
        function updateGlobalStats() {
            // Update games played
            let gamesPlayed = parseInt(localStorage.getItem('gamesPlayed')) || 0;
            gamesPlayed++;
            localStorage.setItem('gamesPlayed', gamesPlayed);
            
            // Calculate trees planted based on CO2 reduced (1 tree per 2 tons)
            let treesPlanted = parseInt(localStorage.getItem('treesPlanted')) || 0;
            treesPlanted += Math.floor(gameState.co2Reduced / 2);
            localStorage.setItem('treesPlanted', treesPlanted);
            
            // Calculate CO2 saved (already tracked in co2Reduced)
            let co2Saved = parseInt(localStorage.getItem('co2Saved')) || 0;
            co2Saved += gameState.co2Reduced;
            localStorage.setItem('co2Saved', co2Saved);
            
            // Update UI
            dom.gamesPlayed.textContent = gamesPlayed;
            dom.totalCo2.textContent = co2Saved;
            dom.treesPlanted.textContent = treesPlanted;
            
            // Calculate progress towards next achievement
            const nextThreshold = achievements.find(a => !gameState.achievementsUnlocked.includes(a.threshold))?.threshold || 100;
            const progress = Math.min(100, (co2Saved % nextThreshold) / nextThreshold * 100);
            
            dom.impactProgress.style.width = `${progress}%`;
            dom.progressText.textContent = `${Math.round(progress)}%`;
        }
        
        function checkAchievements() {
            const totalCo2 = parseInt(localStorage.getItem('co2Saved')) || 0;
            const newAchievements = [];
            
            achievements.forEach(achievement => {
                if (totalCo2 >= achievement.threshold && 
                    !gameState.achievementsUnlocked.includes(achievement.threshold)) {
                    gameState.achievementsUnlocked.push(achievement.threshold);
                    newAchievements.push(achievement);
                }
            });
            
            // Show newest achievement
            if (newAchievements.length > 0) {
                showAchievement(newAchievements[newAchievements.length - 1]);
            }
        }
        
        function showAchievement(achievement) {
            const badge = dom.achievementBadge;
            badge.querySelector('.badge-icon').textContent = achievement.icon;
            badge.querySelector('h4').textContent = achievement.title;
            badge.querySelector('p').textContent = achievement.description;
            
            badge.classList.add('show');
            
            setTimeout(() => {
                badge.classList.remove('show');
            }, 5000);
        }
        
        // ===== Event Listeners =====
        dom.startBtn.addEventListener('click', startGame);
        dom.resetBtn.addEventListener('click', initGame);
        dom.resumeBtn.addEventListener('click', resumeGame);
        
        dom.globalBtn.addEventListener('click', () => {
            if (dom.globalImpact.style.display === 'block') {
                dom.globalImpact.style.display = 'none';
            } else {
                updateGlobalStats();
                dom.globalImpact.style.display = 'block';
            }
        });
        
        // Solution buttons
        dom.renewableBtn.addEventListener('click', () => applySolution('renewable'));
        dom.treeBtn.addEventListener('click', () => applySolution('tree'));
        dom.transportBtn.addEventListener('click', () => applySolution('transport'));
        dom.recycleBtn.addEventListener('click', () => applySolution('recycle'));
        
        // Modal close buttons
        Object.keys(dom.weatherModals).forEach(key => {
            const modal = dom.weatherModals[key];
            const btn = modal.querySelector('.modal-btn');
            
            btn.addEventListener('click', () => {
                modal.classList.remove('active');
                document.getElementById(`${key}-effect`).style.opacity = '0';
            });
        });
        
        // Initialize the game
        initGame();
        
        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>